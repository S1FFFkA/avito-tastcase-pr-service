# Интеграционные тесты

Этот каталог содержит интеграционные тесты для проверки работы системы в реальных условиях с использованием тестовой базы данных.

## Описание тестов

### `main_test.go`
Содержит настройку и очистку тестового окружения:
- Подключение к тестовой базе данных через переменную окружения `TEST_DATABASE_URL`
- Функция `truncateAll` для очистки всех таблиц перед каждым тестом

### `pull_request_flow_test.go`
Тестирует полный жизненный цикл Pull Request:
- Создание команды с участниками
- Создание Pull Request с автоматическим назначением ревьюверов
- Переназначение ревьювера
- Слияние Pull Request
- Попытка переназначения на уже слитом PR (негативный сценарий)
- Каскадное удаление при удалении команды

### `deactivate_team_members_test.go`
Тестирует деактивацию участников команды:
- **TestIntegrationDeactivateTeamMembersFlow**: Деактивация участника с переназначением ревьюверов на открытых PR
- **TestIntegrationDeactivateTeamMembers_Rollback**: Проверка отката транзакции при ошибке переназначения
- **TestIntegrationDeactivateTeamMembers_CannotDeactivateAll**: Валидация запрета на деактивацию всех участников команды

## Запуск тестов

Для запуска интеграционных тестов используйте:

```bash
# PowerShell
.\run-integration-tests.ps1

# Или через Makefile
make integration-tests
```

Тесты требуют наличия переменной окружения `TEST_DATABASE_URL` с подключением к тестовой базе данных.

